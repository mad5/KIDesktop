<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>myKidesktop</title>

<meta http-equiv="cache-control" content="max-age=0" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="expires" content="0" />
<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
<meta http-equiv="pragma" content="no-cache" />

<link href='./resources/simple.css' rel='stylesheet' type='text/css' />
<link href='./resources/ventus.css' rel='stylesheet' type='text/css' />
	
<style>
  body {
  	  padding: 0;
  	  margin:0;
  }
  * {
  	  font-family: verdana;
  }
  #level1 p {
  	  width: 100%;
  }
  #level1 button {
  	  width: 100%;
  }
  .btn {

  background: #599bb3 linear-gradient(to bottom, #599bb3 5%, #408c99 100%) repeat scroll 0 0;
  border-radius: 8px;
  box-shadow: 0 10px 14px -7px #276873;
  color: #ffffff;
  cursor: pointer;
  display: inline-block;
  font-family: Arial;
  font-size: 20px;
  font-weight: bold;
  padding: 13px 32px;
  text-decoration: none;
  text-shadow: 0 1px 0 #3d768a;

  }
</style>
  
<script src="./resources/jquery.min.js"></script>
<script type="text/javascript" src="./resources/ventus.js"></script>
<script src="./socket.io-client/socket.io.js"></script>
<script src="./main.js?x=3"></script>
<script src="./config.js?x=1"></script>

<script src="./resources/raphael-min.js"></script>
<script src="./resources/clock.js?x=1"></script>
  
</head>
<body>

	<div class="buttonbar" id="desktop">

	
		<div style="width:33%;float:left;padding: 20px;box-sizing:border-box;" id="level1">
		
		
		</div>
		<div style="width:66%;float:left" id="level2">
			<div style="padding: 20px;box-sizing:border-box;">
			
				<div style="float:right;" id="clock"></div>
				
			</div>
		</div>
		
	
	</div>
	
	
<div style="display:none;position:absolute;right:30px;bottom:30px;width:500px;height:400px;overflow:autoflow:auto;background-color:white;" id="dbg"></div>

  
<script>

	$(function() {
			var clock = new Clock( "#clock", {"background": "resources/clock-background.png"} );
	});

	
  $(function() {
  		  
	$.ajax({
		"url": CONFIG.apiserver,
		"type": "post",
		"dataType": "json",
		"data": {"action": "listbereiche", "key": CONFIG.key},
		"success": function(res) {
			var html = "";
			console.log(res);
			for(var i=0;i<res.length;i++) {
				html += "<div style='float:left;padding:20px;text-align:center;cursor:pointer;' onclick=\"openBereich('"+res[i].id+"', '"+res[i].titel+"');\">";
				html += '<img src="'+res[i].icon+'" width=100><br>';
				html += "<span style='background-color:rgba(255,255,255,0.3);padding:3px;'>"+res[i].titel+"</span>";
				html += "</div>";
			}
			
			$('#level1').html(html);
		}
	});
  });

  var eintraege = {};
  
  var pos = 50;
  function openBereich(id, titel) {
	if($(".ventusWin"+id).length>0) {
		return;
	}
	
	var html = "<div class='ventusContent"+id+"'>...</div>";
	$('body').append(html);
	
	wm.createWindow.fromQuery(".ventusContent"+id,{
		title: titel,
		x: (pos += 60),
		y: pos,
		classname: "ventusWin"+id,
		width: 500,
		height: 300,

		events: {
			closed: function() {
				this.destroy();
				$('.ventusWin'+id).remove();
			}
		}
	})
	.open();
	
	$.ajax({
		"url":CONFIG.apiserver,
		"type":"post",
		"dataType": "json",
		"data": {"action":"listeintraege", "key": CONFIG.key,"bereich":id},
		"success": function(data) {
			console.log(data);
			var html = "";
			for(var i=0;i<data.length;i++) {
				eintraege[data[i].id] = data[i];
				html += "<div style='float:left;margin:10px;text-align:center;width:90px;height:90px;cursor:pointer;' onclick=\"openEintrag("+data[i].id+");\">";
				html += '<div style="height:75px;"><img src="'+data[i].icon+'" height=75></div>';
				html += "<span style='background-color:rgba(255,255,255,0.3);padding:3px;font-size:0.8em;max-width:85px;'>"+data[i].titel+"</span>";
				html += "</div>";
			}
			
			$(".ventusContent"+id).html(html);
		}
	});
			
  }
  
  function openEintrag(id) {
	var E = eintraege[id];
	if(E.typ=="webseite") {
		openURL(E.befehl);
	}
	//alert(E.typ+"\n"+E.befehl);
	if(E.typ=="programm") {
		openCommand(E.befehl);
	}
	
	if(E.typ=="app") {
		openApp(E.befehl);
	}
  }

  $(function() {
	var wm = new Ventus.WindowManager();
	
	var num = 1;
	window.wm = wm; // For debugging reasons

	$('.expose-button').click(_.throttle(function(){
		if(wm.mode === 'expose')
			wm.mode = 'default';
		else
			wm.mode = 'expose';

		return false;
	}, 1000));
  		  
  });
  </script>
  
</body>
</html>
